<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird by Aivie</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: linear-gradient(to bottom, #70c5ce, #ffffff);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: 'Poppins', sans-serif;
    padding: 0 50px; /* Adjust left and right space here */
  }
  canvas {
    background: linear-gradient(to bottom, #70c5ce 70%, #ded895 100%);
    border: 4px solid #333;
    border-radius: 0; /* Rectangular shape */
  }
  #scoreBoard {
    position: absolute;
    top: 20px;
    color: #fff;
    font-size: 28px;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000;
  }
  #highScoreBoard {
    position: absolute;
    top: 60px;
    color: #fff;
    font-size: 24px;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000;
  }
</style>
</head>
<body>
<canvas id="game" width="700" height="500"></canvas> <!-- Changed to horizontal -->
<div id="scoreBoard">Score: 0</div>
<div id="highScoreBoard">High Score: 0</div>

<script>
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  let frames = 0;
  const DEGREE = Math.PI / 180;

  // Audio context for sounds
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  function playSound(frequency, duration, type = 'sine') {
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    oscillator.frequency.value = frequency;
    oscillator.type = type;
    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
    oscillator.start(audioCtx.currentTime);
    oscillator.stop(audioCtx.currentTime + duration);
  }

  // Game state
  const state = {
    current: 0,
    getReady: 0,
    game: 1,
    over: 2
  };

  // Control
  canvas.addEventListener("click", function() {
    switch (state.current) {
      case state.getReady:
        state.current = state.game;
        break;
      case state.game:
        bird.flap();
        playSound(800, 0.1, 'square'); // Flap sound
        break;
      case state.over:
        resetGame();
        break;
    }
  });

  document.addEventListener("keydown", function(e) {
    if (e.code === "Space") {
      if (state.current === state.getReady) {
        state.current = state.game;
      } else if (state.current === state.game) {
        bird.flap();
        playSound(800, 0.1, 'square'); // Flap sound
      } else if (state.current === state.over) {
        resetGame();
      }
    }
  });

  // Bird
  const bird = {
    x: 50,
    y: 150,
    w: 34,
    h: 24,
    frame: 0,
    gravity: 0.25,
    jump: 4.6,
    speed: 0,
    rotation: 0,
    radius: 12,

    draw() {
      ctx.save();
      ctx.translate(this.x, this.y);
      ctx.rotate(this.rotation);
      ctx.fillStyle = "#ff0";
      ctx.beginPath();
      ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    },

    flap() {
      this.speed = -this.jump;
    },

    update() {
      if (state.current === state.getReady) {
        this.y = 150; 
        this.rotation = 0 * DEGREE;
      } else {
        this.speed += this.gravity;
        this.y += this.speed;

        if (this.y + this.h/2 >= canvas.height - 50) {
          this.y = canvas.height - 50 - this.h/2;
          if (state.current === state.game) {
            state.current = state.over;
            playSound(200, 0.5, 'sawtooth'); // Hit sound
          }
        }

        if (this.speed >= this.jump) {
          this.rotation = 90 * DEGREE;
        } else {
          this.rotation = -25 * DEGREE;
        }
      }
    }
  };

  // Pipes
  const pipes = {
    position: [],
    top: { y: 0 },
    bottom: { y: 0 },
    w: 60,
    h: 400,
    gap: 120,
    dx: 2,

    draw() {
      ctx.fillStyle = "#5ecb63";
      this.position.forEach(pipe => {
        // top pipe
        ctx.fillRect(pipe.x, pipe.y, this.w, this.h);
        // bottom pipe
        ctx.fillRect(pipe.x, pipe.y + this.h + this.gap, this.w, canvas.height - pipe.y - this.h - this.gap);
      });
    },

    update() {
      if (state.current !== state.game) return;

      if (frames % 100 === 0) {
        this.position.push({
          x: canvas.width,
          y: -this.h + Math.random() * (this.h / 2)
        });
      }

      this.position.forEach((pipe, i) => {
        pipe.x -= this.dx;

        // collision detection
        if (
          bird.x + bird.radius > pipe.x &&
          bird.x - bird.radius < pipe.x + this.w &&
          (bird.y - bird.radius < pipe.y + this.h ||
          bird.y + bird.radius > pipe.y + this.h + this.gap)
        ) {
          state.current = state.over;
          playSound(200, 0.5, 'sawtooth'); // Hit sound
        }

        // remove pipes off screen
        if (pipe.x + this.w <= 0) {
          this.position.shift();
          score.value++;
          score.best = Math.max(score.best, score.value);
          localStorage.setItem('flappyHighScore', score.best);
          score.updateDisplay();
          playSound(600, 0.2, 'sine'); // Score sound
        }
      });
    },

    reset() {
      this.position = [];
    }
  };

  // Score
  const score = {
    best: parseInt(localStorage.getItem('flappyHighScore')) || 0,
    value: 0,

    updateDisplay() {
      document.getElementById("scoreBoard").innerText = `Score: ${this.value}`;
      document.getElementById("highScoreBoard").innerText = `High Score: ${this.best}`;
    },

    reset() {
      this.value = 0;
      this.updateDisplay();
    }
  };

  // Background ground
  function drawGround() {
    ctx.fillStyle = "#ded895";
    ctx.fillRect(0, canvas.height - 50, canvas.width, 50);
  }

  // Draw everything
  function draw() {
    ctx.fillStyle = "#70c5ce";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    pipes.draw();
    drawGround();
    bird.draw();

    if (state.current === state.getReady) {
      ctx.fillStyle = "#fff";
      ctx.font = "30px Poppins";
      ctx.fillText("Tap to Start", 250, 200); // Adjusted position for new size
    }
    if (state.current === state.over) {
      ctx.fillStyle = "#ff5050";
      ctx.font = "32px Poppins";
      ctx.fillText("Game Over!", 250, 200); // Adjusted position
      ctx.fillStyle = "#fff";
      ctx.font = "20px Poppins";
      ctx.fillText("Tap to Start", 250, 250); // Adjusted position
    }
  }

  // Update game
  function update() {
    bird.update();
    pipes.update();
  }

  // Reset Game
  function resetGame() {
    state.current = state.getReady;
    pipes.reset();
    score.reset();
    bird.y = 150;
    bird.speed = 0;
  }

  // Game loop
  function loop() {
    update();
    draw();
    frames++;
    requestAnimationFrame(loop);
  }

  score.updateDisplay(); // Load high score on start
  loop();
</script>
</body>
</html>