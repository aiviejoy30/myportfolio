<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Brick Breaker Game</title>
<style>
  body {
    margin: 0;
    background: #12356a url('https://www.transparenttextures.com/patterns/denim.png') repeat;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  #gameContainer {
    width: 70vw;
    height: 70vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #gameCanvas {
    width: 100%;
    height: 100%;
    background: #0a244a;
    border: 6px ridge #7890b7;
    box-shadow: 0 0 30px #abcdeeee inset;
    display: block;
    border-radius: 8px;
  }
  #scoreboard {
    margin-top: 12px;
    color: #cee0ff;
    font-weight: 600;
    font-size: 1.4rem;
    letter-spacing: 1.6px;
    user-select: none;
  }
  #controls {
    margin-top: 12px;
    display: flex;
    gap: 10px;
  }
  button {
    padding: 8px 16px;
    font-size: 1.5rem;
    background: #7890b7;
    color: #cee0ff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  button:hover {
    background: #abcdeeee;
  }
</style>
</head>
<body>
<div id="gameContainer">
  <canvas id="gameCanvas" width="560" height="400"></canvas>
  <div id="scoreboard">Score: 0 - Lives: 3 - High Score: 0 - Level: 1</div>
  <div id="controls">
    <button id="muteBtn">üîä</button>
    <button id="pauseBtn">‚è∏Ô∏è</button>
  </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Audio setup
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(frequency, duration=0.1, type='sine'){
  if (isMuted) return;
  const oscillator = audioCtx.createOscillator();
  const gainNode = audioCtx.createGain();
  oscillator.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  oscillator.frequency.value = frequency;
  oscillator.type = type;
  gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
  oscillator.start(audioCtx.currentTime);
  oscillator.stop(audioCtx.currentTime + duration);
}

// Paddle, ball, bricks setup
const paddle = { height:14, width:84, x:(canvas.width-84)/2, y:canvas.height-30, speed:8 };
const ball = { radius:8, x:canvas.width/2, y:canvas.height-45, baseDx:3, baseDy:-3, dx:3, dy:-3 };
let brick = { rowCount:4, columnCount:13, width:36, height:18, padding:6, offsetTop:44, offsetLeft:30 };
const levelColors = [
  ['#64beff','#99d52c','#fcd634','#a56da1','#dd2b3e','#dd2b3e','#a56da1','#fcd634','#99d52c','#64beff','#99d52c','#fcd634','#a56da1'],
  ['#ff6b6b','#4ecdc4','#45b7d1','#96ceb4','#ffeaa7','#dda0dd','#98d8c8','#f7dc6f','#bb8fce','#85c1e9','#f8c471','#d7bde2','#a9dfbf'],
  ['#e74c3c','#9b59b6','#3498db','#2ecc71','#f1c40f','#e67e22','#1abc9c','#34495e','#e84393','#00cec9','#fdcb6e','#6c5ce7','#a29bfe'],
  ['#d63031','#0984e3','#00b894','#fd79a8','#f0932b','#6c5ce7','#a29bfe','#ffeaa7','#fab1a0','#81ecec','#fdcb6e','#e17055','#74b9ff'],
  ['#636e72','#2d3436','#ddd','#000','#fff','#ccc','#aaa','#888','#666','#444','#222','#111','#000']
];
let brickColors = levelColors[0];
let bricks = [];

function resetBricks(){
  bricks=[];
  for(let r=0;r<brick.rowCount;r++){
    bricks[r]=[];
    for(let c=0;c<brick.columnCount;c++){
      bricks[r][c]={x:0,y:0,status:1,color:brickColors[c]};
    }
  }
}

// --- Load saved high score ---
let savedHigh = localStorage.getItem('brickBreakerHighScore');
let highScore = savedHigh ? parseInt(savedHigh) : 0;

let score=0, lives=3;
let level=1, gameState='playing', rightPressed=false, leftPressed=false;
let isMuted = false, isPaused = false;

document.addEventListener("keydown", keyDownHandler, false);
document.addEventListener("keyup", keyUpHandler, false);
canvas.addEventListener("mousemove", mouseMoveHandler, false);
canvas.addEventListener("click", ()=>{ if(gameState==='gameOver') resetGame(); });

function keyDownHandler(e){ if(e.key==="ArrowRight") rightPressed=true; if(e.key==="ArrowLeft") leftPressed=true; }
function keyUpHandler(e){ if(e.key==="ArrowRight") rightPressed=false; if(e.key==="ArrowLeft") leftPressed=false; }
function mouseMoveHandler(e){
  let rect=canvas.getBoundingClientRect();
  let relativeX=e.clientX-rect.left;
  if(relativeX>0 && relativeX<canvas.width) paddle.x=relativeX-paddle.width/2;
  if(paddle.x<0) paddle.x=0;
  if(paddle.x+paddle.width>canvas.width) paddle.x=canvas.width-paddle.width;
}

function drawPaddle(){
  ctx.fillStyle='#dde2ea';
  ctx.fillRect(paddle.x,paddle.y,paddle.width,paddle.height);
  ctx.lineWidth=2; ctx.strokeStyle='#7a8b9f';
  ctx.strokeRect(paddle.x,paddle.y,paddle.width,paddle.height);
}
function drawBall(){
  ctx.beginPath();
  ctx.arc(ball.x,ball.y,ball.radius,0,Math.PI*2);
  ctx.fillStyle='#d8dde7';
  ctx.fill();
  ctx.closePath();
}
function drawBricks(){
  for(let r=0;r<brick.rowCount;r++){
    for(let c=0;c<brick.columnCount;c++){
      let b=bricks[r][c];
      if(b.status===1){
        let brickX=c*(brick.width+brick.padding)+brick.offsetLeft;
        let brickY=r*(brick.height+brick.padding)+brick.offsetTop;
        b.x=brickX; b.y=brickY;
        ctx.fillStyle=b.color;
        ctx.fillRect(brickX,brickY,brick.width,brick.height);
        ctx.lineWidth=2; ctx.strokeStyle='#464a56';
        ctx.strokeRect(brickX,brickY,brick.width,brick.height);
      }
    }
  }
}
function drawScoreLives(){
  document.getElementById('scoreboard').textContent=
    `Score: ${score} - Lives: ${lives} - High Score: ${highScore} - Level: ${level}`;
}

function levelUp(){
  level++;
  brick.rowCount = Math.min(brick.rowCount + 1, 10);
  ball.baseDx += (ball.baseDx > 0 ? 0.5 : -0.5);
  ball.baseDy += (ball.baseDy > 0 ? 0.5 : -0.5);
  ball.dx = ball.baseDx;
  ball.dy = ball.baseDy;
  ball.x = canvas.width/2;
  ball.y = canvas.height-45;
  paddle.x = (canvas.width - paddle.width)/2;
  brickColors = levelColors[Math.min(level-1, levelColors.length-1)];
  resetBricks();
  playSound(800, 0.2, 'sine');
}

function collisionDetection(){
  for(let r=0;r<brick.rowCount;r++){
    for(let c=0;c<brick.columnCount;c++){
      let b=bricks[r][c];
      if(b.status===1 && ball.x>b.x && ball.x<b.x+brick.width && ball.y>b.y && ball.y<b.y+brick.height){
        ball.dy=-ball.dy;
        b.status=0;
        score+=1;
        playSound(600,0.1,'square');
        if(score == brick.rowCount * brick.columnCount){ levelUp(); }
        if(score>highScore){
          highScore=score;
          localStorage.setItem('brickBreakerHighScore', highScore); // üî• Save permanently
        }
      }
    }
  }
  if(ball.y+ball.radius>paddle.y && ball.x>paddle.x && ball.x<paddle.x+paddle.width){
    ball.dy=-ball.dy;
    let deltaX=ball.x-(paddle.x+paddle.width/2);
    ball.dx=deltaX*0.15;
    playSound(400,0.05,'triangle');
  }
  if(ball.x+ball.dx>canvas.width-ball.radius || ball.x+ball.dx<ball.radius){
    ball.dx=-ball.dx; playSound(300,0.05,'sawtooth');
  }
  if(ball.y+ball.dy<ball.radius){
    ball.dy=-ball.dy; playSound(300,0.05,'sawtooth');
  } else if(ball.y+ball.dy>canvas.height-ball.radius){
    lives--; playSound(200,0.2,'sawtooth');
    if(lives<=0){
      gameState='gameOver';
      playSound(150,0.5,'sawtooth');
    } else {
      ball.x=canvas.width/2; ball.y=canvas.height-45;
      ball.dx=ball.baseDx; ball.dy=ball.baseDy;
      paddle.x=(canvas.width-paddle.width)/2;
    }
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawBricks(); drawPaddle(); drawBall(); drawScoreLives();
  if(gameState==='playing' && !isPaused){
    ball.x+=ball.dx; ball.y+=ball.dy; collisionDetection();
    if(rightPressed && paddle.x<canvas.width-paddle.width) paddle.x+=paddle.speed;
    if(leftPressed && paddle.x>0) paddle.x-=paddle.speed;
  } else if(gameState==='gameOver'){
    ctx.fillStyle="#ff5050"; ctx.font="32px Segoe UI"; ctx.fillText("Game Over!",180,200);
    ctx.fillStyle="#cee0ff"; ctx.font="20px Segoe UI"; ctx.fillText("Click to Restart",140,240);
  } else if(isPaused){
    ctx.fillStyle="#cee0ff"; ctx.font="24px Segoe UI"; ctx.fillText("Paused",220,200);
  }
  requestAnimationFrame(draw);
}

function resetGame(){
  gameState='playing';
  score=0; lives=3; level=1;
  brick.rowCount=4;
  ball.baseDx=3; ball.baseDy=-3;
  ball.x=canvas.width/2; ball.y=canvas.height-45;
  ball.dx=ball.baseDx; ball.dy=ball.baseDy;
  paddle.x=(canvas.width-paddle.width)/2;
  brickColors=levelColors[0];
  resetBricks();
}

// Button events
document.getElementById('muteBtn').addEventListener('click', () => {
  isMuted = !isMuted;
  document.getElementById('muteBtn').textContent = isMuted ? 'üîá' : 'üîä';
});
document.getElementById('pauseBtn').addEventListener('click', () => {
  isPaused = !isPaused;
  document.getElementById('pauseBtn').textContent = isPaused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
});

resetBricks();
draw();
</script>
</body>
</html>
